(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{245:function(e,t,a){"use strict";a.r(t);var n=a(37),o=Object(n.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("Asynchronous codes are common in JS programming, like fetching data from an endpoint and reading dir/files. Often they require us to pass a "),a("em",[e._v("callback")]),e._v(" function that will be executed when the action is completed.")]),e._v(" "),a("h1",{attrs:{id:"the-problem-with-callback-async"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-problem-with-callback-async","aria-hidden":"true"}},[e._v("#")]),e._v(" The problem with callback async")]),e._v(" "),a("p",[e._v("The problem with callback async is that they can get messy.")]),e._v(" "),a("p",[e._v("If I want to read a file (using "),a("a",{attrs:{href:"https://nodejs.org/api/fs.html#fs_fs_readfile_path_options_callback",target:"_blank",rel:"noopener noreferrer"}},[e._v("fs.readFile"),a("OutboundLink")],1),e._v("), I can do it like this:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('fs.readFile(\'./file/location.md\', \'utf-8\', function(err, val){\n  if(err) throw new Error ("Something terrible happened")\n  console.log("Content: ", val)\n})\nconsole.log("Waiting...")\n')])])]),a("p",[e._v("You'll notice "),a("code",[e._v('"Waiting"')]),e._v(" is displayed before "),a("code",[e._v('"Content"')]),e._v(". This is because JS automatically moves "),a("strong",[e._v("all")]),e._v(' async functions at the back of the line (regardless how "fast" they execute).')]),e._v(" "),a("p",[e._v("Now this is a big deal if we need to use the result of that async function for our next action. If we need to use the result of our callback function, the following won't work:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("let pathToNextLocation; \nfs.readFile('./file/location1.md', 'utf-8', function(err, val){\n  if(err) throw new Error\n  pathToNextLocation = val; \n})\n\nconsole.log(pathToNextLocation); \n")])])]),a("p",[e._v("We will need to do this instead:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("let pathToNextLocation\nfs.readFile('./file/location1.md', 'utf-8', function(err, val){\n  if(err) throw new Error\n  pathToNextLocation = val; \n  fs.readFile(pathToNextLocation, 'utf-8', function(err, val) {\n    // do stuff!\n  })\n})\n")])])]),a("p",[e._v("What if we need to execute four async functions in sequence? We would have to nest it four levels deep. This is one big spaghetti.")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://media.giphy.com/media/r9jG5FH7chblC/giphy.gif",alt:"big spaghetti"}})]),e._v(" "),a("h1",{attrs:{id:"better-way-to-handle-async-promises"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#better-way-to-handle-async-promises","aria-hidden":"true"}},[e._v("#")]),e._v(" Better way to handle async: Promises")]),e._v(" "),a("p",[e._v("A better way to deal with async function is to use promises. Promises, like callbacks, are asynchronous. Unlike callbacks, they can be chained.")]),e._v(" "),a("p",[e._v("Promise takes 2 arguments and we need to "),a("code",[e._v("resolve")]),e._v(" it - think of it like Promise's own way to return value when it is done.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("new Promise((resolve, reject) =>\n  resolve('Hello promise')\n)\n.then(value => console.log(value))\n")])])]),a("p",[e._v("This "),a("code",[e._v("then")]),e._v(" chain is really awesome, because now we can do something like this:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("asyncReadFile('./file/to/location1.md', 'utf-8')\n.then(value => {\n  return anotherPromise\n})\n.then(value => {\n  return anotherPromise\n})\n.then(value => {\n  return yetAnotherPromise\n})\n// and so on\n")])])]),a("p",[e._v("This looks MUCH better than callback spaghetti.")]),e._v(" "),a("h1",{attrs:{id:"putting-the-two-together-replace-all-callbacks-with-promises"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#putting-the-two-together-replace-all-callbacks-with-promises","aria-hidden":"true"}},[e._v("#")]),e._v(" Putting the two together: replace all callbacks with promises")]),e._v(" "),a("p",[e._v("We learned two things:")]),e._v(" "),a("ol",[a("li",[e._v("Too many callbacks leads to spaghetti code")]),e._v(" "),a("li",[e._v("Chained promises are easy to read")])]),e._v(" "),a("p",[e._v("However, callbacks functions are not the same thing as promises. "),a("code",[e._v("fs.readFile")]),e._v(" do not return promises. We can't just use "),a("code",[e._v("then")]),e._v(" chain on several "),a("code",[e._v("fs.readFile")]),e._v(" together.")]),e._v(" "),a("blockquote",[a("p",[e._v('"Hmm, I wonder if there is a way to convert them callbacks into promises so I can chain them and make them look pretty?" - me thinking')])]),e._v(" "),a("p",[e._v("Absolutely!! "),a("a",{attrs:{href:"https://nodejs.org/dist/latest-v8.x/docs/api/util.html#util_util_promisify_original",target:"_blank",rel:"noopener noreferrer"}},[e._v("Promisify"),a("OutboundLink")],1),e._v(" does JUST that.")]),e._v(" "),a("p",[e._v("Promisify is part of util built into Node 8+. It accepts a function that accepts a callback function (wow, that's a mouthful). The resulting function is a function that returns a promise. Let's jump straight into it. It will make sense after we run it ourselves.")]),e._v(" "),a("p",[e._v("Let's create several files in a directory that contains the name of other files to read. Then we will read the first file - see if we can make it to the last file.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('// file1.md\nfile2.md\n\n// file2.md\nfile3.md\n\n// file3.md\nFinished!\n\n// reader.js\nconst fs = require("fs");\nconst { promisify } = require("util");\n\nconst promiseReadFile = promisify(fs.readFile);\n\npromiseReadFile("file1.md", "utf-8")\n  .then(content => {\n    const nextFileToRead = content.trim();\n    return promiseReadFile(nextFileToRead, "utf-8");\n  })\n  .then(content => {\n    const nextFileToRead = content.trim();\n    return promiseReadFile(nextFileToRead, "utf-8");\n  })\n  .then(content => {\n    console.log(content.trim());\n  });\n')])])]),a("p",[e._v("Now let's "),a("code",[e._v("node ./reader.js")]),e._v(" and see what happens. You should see "),a("code",[e._v('"Finished!"')]),e._v(" printed.")]),e._v(" "),a("p",[e._v("Sweet! Now that is one spaghetti I don't mind eating.")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://media.giphy.com/media/3o72F2CaK3Hk53WxGg/giphy.gif",alt:"delicious spaghetti"}})]),e._v(" "),a("p",[e._v("Javascript has another way to handle promises: "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function",target:"_blank",rel:"noopener noreferrer"}},[e._v("async/await"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("To test your understanding, can you convert promisified code above from "),a("code",[e._v("then")]),e._v(" into "),a("code",[e._v("async/await")]),e._v("?")]),e._v(" "),a("p",[e._v("Thanks for reading. Happy hackin'! Let me know if you have questions!")]),e._v(" "),a("h1",{attrs:{id:"resources"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resources","aria-hidden":"true"}},[e._v("#")]),e._v(" Resources")]),e._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://2ality.com/2017/05/util-promisify.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("util promisify"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://medium.com/greyatom/node8s-util-promisify-is-so-awesome-9819f1b56d18",target:"_blank",rel:"noopener noreferrer"}},[e._v("node8 util promisify is so awesome"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://javascript.info/promisify",target:"_blank",rel:"noopener noreferrer"}},[e._v("Promisification"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://medium.com/trabe/understanding-nodes-promisify-and-callbackify-d2b04efde0e0",target:"_blank",rel:"noopener noreferrer"}},[e._v("understanding nodes promisify and callbackify"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"}},[e._v("Promise docs"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://dev.to/martinnrdstrm/callback-functions-innodejs--2607",target:"_blank",rel:"noopener noreferrer"}},[e._v("callback functions in nodeJS"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://levelup.gitconnected.com/javascript-and-asynchronous-magic-bee537edc2da",target:"_blank",rel:"noopener noreferrer"}},[e._v("Javascript and asynchronous magic"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://medium.com/better-programming/is-javascript-synchronous-or-asynchronous-what-the-hell-is-a-promise-7aa9dd8f3bfb",target:"_blank",rel:"noopener noreferrer"}},[e._v("Is JavaScript Synchronous or Asynchronous? What the Hell is a Promise?"),a("OutboundLink")],1)])])])},[],!1,null,null,null);t.default=o.exports}}]);