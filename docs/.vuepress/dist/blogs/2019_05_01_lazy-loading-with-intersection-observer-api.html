<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lazy Loading With IntersectionObserver API | Hello there.</title>
    <meta name="description" content="Things Iggy writes about">
    
    
    <link rel="preload" href="/assets/css/0.styles.74245eb8.css" as="style"><link rel="preload" href="/assets/js/app.411ac2ac.js" as="script"><link rel="preload" href="/assets/js/2.826a9c57.js" as="script"><link rel="preload" href="/assets/js/10.33a00c4d.js" as="script"><link rel="prefetch" href="/assets/js/11.9e2c5904.js"><link rel="prefetch" href="/assets/js/12.82d02492.js"><link rel="prefetch" href="/assets/js/13.2bba91b0.js"><link rel="prefetch" href="/assets/js/14.496d3aa4.js"><link rel="prefetch" href="/assets/js/15.8e326966.js"><link rel="prefetch" href="/assets/js/16.a4da2abb.js"><link rel="prefetch" href="/assets/js/17.8eec3b06.js"><link rel="prefetch" href="/assets/js/18.edb89630.js"><link rel="prefetch" href="/assets/js/19.4431ab75.js"><link rel="prefetch" href="/assets/js/20.4463634e.js"><link rel="prefetch" href="/assets/js/21.d60a97f5.js"><link rel="prefetch" href="/assets/js/22.443a8923.js"><link rel="prefetch" href="/assets/js/23.cdd341e7.js"><link rel="prefetch" href="/assets/js/3.14889d81.js"><link rel="prefetch" href="/assets/js/4.6512c86b.js"><link rel="prefetch" href="/assets/js/5.839bfab5.js"><link rel="prefetch" href="/assets/js/6.3a95a3b3.js"><link rel="prefetch" href="/assets/js/7.00a5fbce.js"><link rel="prefetch" href="/assets/js/8.27c044bc.js"><link rel="prefetch" href="/assets/js/9.b297b1cf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.74245eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><header class="px-6 bg-white flex flex-wrap items-center py-8"><input type="checkbox" id="menu-toggle" class="hidden"> <label id="hamburger" for="menu-toggle" class="fixed cursor-pointer block z-20"><div id="burgerToggle" class="cursor-pointer"><span></span> <span></span> <span></span></div></label> <div id="sideMenu" class="bg-gray-800 z-10 fixed top-0 left-0 bottom-0 w-64"><ul class="my-16 mx-4"><li class="my-4 cursor-default hover:no-underline"><div class="container flex flex-col items-start justify-center"><div class="my-4"><img src="/assets/img/iggy_square.57401581.jpg" class="ml-0 h-20 w-20 mb-4 rounded-full"> <div class="font-bold text-white mb-4">Igor Irianto</div> <div class="font-light text-gray-500 text-sm">Frontend dev who likes to post about Vim, JS, and other computer stuff. Lives in Dallas. Married. He doesn't have a lot of twitter follower so you should <a href="https://twitter.com/iggredible">add him</a>.</div></div></div></li> <li class="my-4 text-white font-light"><a href="#">Blogs</a></li> <li class="my-4 text-white font-light"><a href="#">About</a></li></ul></div> <div class="absolute top-0 right-0 m-4"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></header> <div class="container max-w-5xl mx-auto"><!----> <div class="max-w-4xl mx-auto"><div class="relative"><div class="fixed top-4 left-0 pl-5"><a href="/">Home</a></div> <div class="content mx-16 lg:mx-24"><h1 class="text-center">Lazy Loading With IntersectionObserver API</h1> <h6 class="text-center italic font-light m-4">strategy to use intersection observer for lazy loading</h6> <h4></h4> <div class="content__default"><p><img src="https://thepracticaldev.s3.amazonaws.com/i/dfhkoiqimufpr5zv0z36.gif" alt="lazy-kat"></p> <p>Hello dev.to folks! This is my first post - woot! Pretty excited to share what I have been learning recently about lazy-loading. Please let me know how I can make this better!</p> <p>Lazy loading image is useful for loading page with many contents. We can easily find libraries to do that, such as <a href="https://github.com/malchata/yall.js" target="_blank" rel="noopener noreferrer">yall.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://apoorv.pro/lozad.js/" target="_blank" rel="noopener noreferrer">lozad.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. What most of these libraries have in common is they both use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener noreferrer">Intersection Observer API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Let’s learn how to use <code>IntersectionObserver</code> so we can understand how these libraries work — or even write our own!</p> <p>First, I will briefly explain what <code>IntersectionObserver</code> does and second, how to use it to lazy load your own images.</p> <h1 id="what-does-intersectionobserver-do"><a href="#what-does-intersectionobserver-do" aria-hidden="true" class="header-anchor">#</a> What Does IntersectionObserver do?</h1> <p>(In layman’s words) <code>IntersectionObserver</code> <em>asynchronously detects when an element intersects with ancestor element (usually viewport) and calls a callback function.</em></p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/gwvj2lrwfy97ljpj9lv3.png" alt="viewport schematics"></p> <p>Imagine a viewport containing images. When page loads, some images are positioned directly within viewport while some are sitting below viewport, waiting for user to scroll down so they can be seen. As user scrolls down, the top part of some lower-positioned images would eventually intersect with the bottom viewport. It is when the first top image pixel intersects with viewport the callback function loads the image.</p> <h1 id="sample-usage"><a href="#sample-usage" aria-hidden="true" class="header-anchor">#</a> Sample Usage</h1> <p>Let’s read the docs! Mozilla kindly gives us a starting point.</p> <div class="language- extra-class"><pre class="language-text"><code>var options = {
  root: document.querySelector('#scrollArea'),
  rootMargin: '0px',
  threshold: 1.0
}

var observer = new IntersectionObserver(callback, options);
var target = document.querySelector('#listItem');
observer.observe(target);
</code></pre></div><p>Above is the minimum setup to lazy load <code>#listItem</code> (technically options is optional, so <code>var observer = new IntersectionObserver(callback);</code> is a more concise way to run it).</p> <p>Aight, let’s use it on a more realistic scenario. We are going to:</p> <ol><li>Have 10 images in HTML that we will lazy load</li> <li>Add CSS fade animation</li> <li>Add IntersectionObserver to load images</li></ol> <h1 id="html-setup"><a href="#html-setup" aria-hidden="true" class="header-anchor">#</a> HTML Setup</h1> <div class="language- extra-class"><pre class="language-text"><code>&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=1&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=2&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=3&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=4&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=5&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=6&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=7&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=8&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=9&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;img data-src=”http://placehold.it/300x300?text=10&quot;&gt;&lt;/div&gt;
</code></pre></div><p>If you notice, it does not use <code>src</code> but <code>data-src</code> attribute. One strategy for lazy loading is to start with HTML’s <code>data-*</code> attribute because <code>data-src</code> will not load the image.</p> <h1 id="css-setup"><a href="#css-setup" aria-hidden="true" class="header-anchor">#</a> CSS Setup</h1> <div class="language- extra-class"><pre class="language-text"><code>.fade {
 animation-duration: 3s;
 animation-name: fade;
}
@keyframes fade {
 from {
 opacity: 0;
 }
 to {
 opacity: 1;
 }
}
</code></pre></div><p>This setup is optional. I think helps with our observation (plus it is more aesthetically pleasing) to have the image lazy load with fade animation.</p> <p>Btw, you can check when the image is downloaded on network tabs if you use Chrome DevTool.</p> <h1 id="js-setup"><a href="#js-setup" aria-hidden="true" class="header-anchor">#</a> JS Setup</h1> <p>I want the images to load only when 50% of it intersects with viewport. This is how to set it up:</p> <div class="language- extra-class"><pre class="language-text"><code>const images = document.querySelectorAll(‘img’)
const observer = new IntersectionObserver(entries =&gt; {
 entries.forEach(entry =&gt; {
 if(entry.isIntersecting) {
 const target = entry.target
 target.setAttribute(‘src’, target.dataset.src)
 target.classList.add(‘fade’)
 observer.unobserve(target)
 }
 })
}, {
 threshold: 0.5
})
images.forEach(image =&gt; observer.observe(image))
</code></pre></div><p>I want to highlight a few things that I was struggling to understand when learning IntersectionObserver.</p> <ul><li><p>The argument entries represents all the image element under <code>IntersectionObserver</code> (I find it a bit odd having to iterate twice with <code>images.forEach</code> and <code>entries.forEach</code>, but that’s the way it is done). At initial page load, all entries are called. Some immediately intersects (if they are within viewports when page renders) while some don’t. The ones that immediately intersects have their callback function called immediately.</p></li> <li><p><code>entry.isIntersecting</code> returns true when the image intersects with viewport. Another common check for intersectionality is <code>entry.intersectionRatio &gt; 0</code>.</p></li> <li><p>As mentioned before, a common strategy for lazy-loading is to initially start without <code>src</code>. We transfer values from <code>data-src</code> to <code>src</code> right before user is about to see it.</p></li> <li><p>It is good practice to unobserve the object after it has been loaded.
We can change the amount or location of intersectionality with either <code>threshold</code> or <code>rootMargin</code> option. The ancestor element can be changed with root (default is viewport).</p></li></ul> <h1 id="conclusion"><a href="#conclusion" aria-hidden="true" class="header-anchor">#</a> Conclusion</h1> <p>At the time of this writing, intersectionObserver is usable in major browsers except for IE. Check <a href="https://caniuse.com/#feat=intersectionobserver" target="_blank" rel="noopener noreferrer">caniuse<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> site for complete list.</p> <p><code>IntersectionObserver</code> is useful to lazy load element into viewport by passing the value from data-src into src upon callback. The same strategy can be applied to other elements.</p> <p>Below are articles I read regarding <code>IntersectionObserver</code> I found useful (I am not affiliated with any of them, just appreciative of the information they gave and I hope it will help you too!)</p> <ul><li><p><a href="https://fireship.io/snippets/intersection-observer-lazy-load-images/" target="_blank" rel="noopener noreferrer">fireship<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://alligator.io/js/intersection-observer/" target="_blank" rel="noopener noreferrer">alligatorio<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/" target="_blank" rel="noopener noreferrer">googledev<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <p>Please feel free to let me know if you find any mistakes or how I can improve this. Thank you so much for reading this far. Y’all are awesome!</p></div></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.411ac2ac.js" defer></script><script src="/assets/js/2.826a9c57.js" defer></script><script src="/assets/js/10.33a00c4d.js" defer></script>
  </body>
</html>
